# Installation guide

This document describes a detailed installation procedure for `ap-bridge` (Archipelago ↔ Twitch bridge).

---

## 1. Prerequisites

Make sure you have:

- Git
- CMake 3.16 or newer
- A C++17 compiler (for example: `g++` or `clang++`)
- Python 3.10 or newer (3.11 recommended)
- A Twitch account and an OAuth token for the bot
- Access to an Archipelago server and a valid slot

---

## 2. Clone the repository

From a terminal:

    git clone https://github.com/<your-account>/ap-bridge.git
    cd ap-bridge

Replace `<your-account>` with your GitHub username or organization.

---

## 3. Configure the project

### 3.1. Create your local config file

Copy the example config:

    cp config/config.example.json config/config.json

### 3.2. Edit `config/config.json`

Open `config/config.json` in your editor and fill in:

- Section `archipelago`:
  - `host`         → address of your Archipelago server
  - `port`         → port of your Archipelago server
  - `game`         → game name (for example: `Pokemon Emerald`)
  - `slot_name`    → your slot name on the server
  - `password`     → slot password if any (empty string otherwise)

- Section `paths`:
  - `state_file`   → usually `data/state.json`
  - log file paths if you want to adjust them

- Section `twitch`:
  - `username`     → Twitch username of the bot account
  - `oauth_token`  → OAuth token for that account
  - `channel`      → Twitch channel where the bot should join

- Section `bot_settings`:
  - `prefix`       → command prefix (default usually `!`)
  - `help_url`     → link to your documentation or commands list
  - `author`       → your name or handle
  - `repo_url`     → link to the GitHub repository
  - any other cosmetic or behaviour flags you want to adjust

Important: do not commit `config/config.json` to Git. This file contains secrets and is intentionally listed in `.gitignore`.

---

## 4. Build the fetcher (Sphere 1 – C++)

The fetcher is the C++ component that connects to Archipelago and writes `data/state.json`.

From the repository root:

    mkdir -p build
    cd build
    cmake ..
    make -j$(nproc)

If the configuration and build complete successfully, you should obtain an executable, typically named `ap_fetcher`, inside the `build` directory.

To run the fetcher from the repository root:

    ./build/ap_fetcher

If everything is set up correctly, the fetcher will:

- connect to the Archipelago server using the values in `config/config.json`
- start writing and updating `data/state.json`
- optionally write a fetcher log file if configured

You can confirm it works by checking that:

- the program prints connection information
- the `data` directory now contains a `state.json` file that grows as items and events occur in game

---

## 5. Set up the interpreter / Twitch bot (Sphere 2 – Python)

The interpreter is the Python bot that reads `data/state.json` and talks to Twitch chat.

From the repository root:

    python3 -m venv venv
    source venv/bin/activate    (on Windows/PowerShell: .\venv\Scripts\Activate.ps1)
    pip install -r requirements.txt

This will install the necessary Python dependencies, including TwitchIO 2.x.

Then start the bot:

    cd interpreter
    python main.py

If everything is correct, the bot will:

- connect to Twitch using the credentials in `config/config.json`
- join the target channel
- periodically read `data/state.json` generated by the fetcher
- answer to commands like `!help`, `!seedinfo`, `!progress`, and others

---

## 6. First-time checklist

Use this list to verify the installation:

- `config/config.json` exists and is correctly filled.
- `./build/ap_fetcher` runs without crashing.
- `data/state.json` appears and updates while the fetcher is running.
- The Python virtualenv is active when you run `python main.py`.
- The bot joins your Twitch channel.
- In chat:
  - `!help` displays the command list or a help message.
  - `!seedinfo` shows the seed and Archipelago versions.
  - `!progress` shows a sensible number of checks completed.

If something fails, check:

- network connectivity to the Archipelago server
- correctness of the `archipelago` section in `config/config.json`
- Twitch OAuth token validity and permissions
- logs for the fetcher and the bot (if configured), generally under `logs/`

---

## 7. Platform notes

- Linux and WSL are the primary development and testing environments.
- Windows builds are expected to work using MSYS2 or a similar environment for the C++ part, and a normal Python installation for the bot.
- macOS should work with `clang++` and CMake for the fetcher, but is not officially tested yet.
  Feedback and patches for macOS support are welcome.

